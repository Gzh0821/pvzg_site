import{b2 as v,U as m,a4 as n,bg as T,Y as S,bh as w,W as y,bi as c,ap as h,bj as F,bk as x,V as A,aa as E,aT as p,b7 as $,bl as l,a1 as b}from"./app-6OaNHunP.js";import{R as M}from"./vidstack-C-clE4br-rSscZ6-8.js";let o=null,d=[],u=[];function f(){return o??(o=new AudioContext)}function P(){const s=f(),t=s.createGain();return t.connect(s.destination),d.push(t),t}function G(s,t){const i=f(),e=i.createMediaElementSource(s);return t&&e.connect(t),u.push(e),e}function C(s){const t=d.indexOf(s);t!==-1&&(d.splice(t,1),s.disconnect(),k())}function j(s){const t=u.indexOf(s);t!==-1&&(u.splice(t,1),s.disconnect(),k())}function k(){o&&d.length===0&&u.length===0&&o.close().then(()=>{o=null})}class K{constructor(t,i){this.a=t,this.E=i,this.xa=null,this.Ka=null}get currentGain(){var t,i;return((i=(t=this.xa)==null?void 0:t.gain)==null?void 0:i.value)??null}get supported(){return!0}setGain(t){const i=this.currentGain;if(t!==this.currentGain){if(t===1&&i!==1){this.removeGain();return}this.xa||(this.xa=P(),this.Ka&&this.Ka.connect(this.xa)),this.Ka||(this.Ka=G(this.a,this.xa)),this.xa.gain.value=t,this.E(t)}}removeGain(){this.xa&&(this.Ka&&this.Ka.connect(f().destination),this.eg(),this.E(null))}destroy(){this.li(),this.eg()}li(){if(this.Ka)try{j(this.Ka)}catch{}finally{this.Ka=null}}eg(){if(this.xa)try{C(this.xa)}catch{}finally{this.xa=null}}}const N=["focus","blur","visibilitychange","pageshow","pagehide"];class L{constructor(){this.za=b(g()),this.on=b(document.visibilityState)}connect(){for(const t of N)h(window,t,this.An.bind(this));c&&h(window,"beforeunload",t=>{this.zn=setTimeout(()=>{t.defaultPrevented||t.returnValue.length>0||(this.za.set("hidden"),this.on.set("hidden"))},0)})}get pageState(){return this.za()}get visibility(){return this.on()}An(t){c&&window.clearTimeout(this.zn),(t.type!=="blur"||this.za()==="active")&&(this.za.set(g(t)),this.on.set(document.visibilityState=="hidden"?"hidden":"visible"))}}function g(s){return(s==null?void 0:s.type)==="blur"||document.visibilityState==="hidden"?"hidden":document.hasFocus()?"active":"passive"}class z{constructor(t,i){this.p=t,this.b=i,this.Ya=w(),this.jc=!1,this.ae=!1,this.be=!1,this.fa=new M(this.kc.bind(this)),this.Qn=new L,this.Mn=0,this.Nn=-1,this.hg=void 0,this.zi=void 0,this.mi(),this.Qn.connect(),y(this.ni.bind(this)),m(this.ce.bind(this))}get a(){return this.p.media}get c(){return this.b.delegate.c}ce(){this.ae=!1,this.be=!1,this.fa.$(),this.Ya.empty()}kc(){const t=this.a.currentTime;!(c&&t-this.Nn<.35)&&this.Mn!==t&&(this.Jb(t),this.Mn=t)}mi(){this.F("loadstart",this.Ma),this.F("abort",this.gg),this.F("emptied",this.oi),this.F("error",this.Q),this.F("volumechange",this.Na)}pi(){this.ae||(this.Ya.add(this.F("loadeddata",this.qi),this.F("loadedmetadata",this.ri),this.F("canplay",this.ed),this.F("canplaythrough",this.si),this.F("durationchange",this.de),this.F("play",this.gc),this.F("progress",this.nb),this.F("stalled",this.ti),this.F("suspend",this.ui),this.F("ratechange",this.vi)),this.ae=!0)}wi(){this.be||(this.Ya.add(this.F("pause",this.ib),this.F("playing",this.xi),this.F("seeked",this.ob),this.F("seeking",this.yi),this.F("ended",this.lc),this.F("waiting",this.ee)),this.be=!0)}F(t,i){return h(this.a,t,i.bind(this))}Ai(t){}Jb(t,i){const e=Math.min(t,this.b.$state.seekableEnd());this.c("time-change",e,i)}Ma(t){if(this.a.networkState===3){this.gg(t);return}this.pi(),this.c("load-start",void 0,t)}gg(t){this.c("abort",void 0,t)}oi(){this.c("emptied",void 0,event)}qi(t){this.c("loaded-data",void 0,t)}ri(t){this.Mn=0,this.Nn=-1,this.wi(),this.c("loaded-metadata",void 0,t),(F||c&&x(this.b.$state.source()))&&this.b.delegate.Ga(this.fe(),t)}fe(){return{provider:A(this.b.$provider),duration:this.a.duration,buffered:this.a.buffered,seekable:this.a.seekable}}gc(t){this.b.$state.canPlay&&this.c("play",void 0,t)}ib(t){this.a.readyState===1&&!this.jc||(this.jc=!1,this.fa.$(),this.c("pause",void 0,t))}ed(t){this.b.delegate.Ga(this.fe(),t)}si(t){this.b.$state.started()||this.c("can-play-through",this.fe(),t)}xi(t){this.a.paused||(this.jc=!1,this.c("playing",void 0,t),this.fa.Xa())}ti(t){this.c("stalled",void 0,t),this.a.readyState<3&&(this.jc=!0,this.c("waiting",void 0,t))}ee(t){this.a.readyState<3&&(this.jc=!0,this.c("waiting",void 0,t))}lc(t){this.fa.$(),this.Jb(this.a.duration,t),this.c("end",void 0,t),this.b.$state.loop()&&E(this.a.controls)&&(this.a.controls=!1)}ni(){const t=this.b.$state.paused(),i=this.Qn.visibility==="hidden";(t||i)&&h(this.a,"timeupdate",this.mc.bind(this))}mc(t){this.Jb(this.a.currentTime,t)}de(t){this.b.$state.ended()&&this.Jb(this.a.duration,t),this.c("duration-change",this.a.duration,t)}Na(t){const i={volume:this.a.volume,muted:this.a.muted};this.c("volume-change",i,t)}ob(t){this.Nn=this.a.currentTime,this.Jb(this.a.currentTime,t),this.c("seeked",this.a.currentTime,t),Math.trunc(this.a.currentTime)===Math.trunc(this.a.duration)&&p(this.a.duration)>p(this.a.currentTime)&&(this.Jb(this.a.duration,t),this.a.ended||this.b.player.dispatch(new $("media-play-request",{trigger:t})))}yi(t){this.c("seeking",this.a.currentTime,t)}nb(t){const i={buffered:this.a.buffered,seekable:this.a.seekable};this.c("progress",i,t)}ui(t){this.c("suspend",void 0,t)}vi(t){this.c("rate-change",this.a.playbackRate,t)}Q(t){const i=this.a.error;if(!i)return;const e={message:i.message,code:i.code,mediaError:i};this.c("error",e,t)}}class O{constructor(t,i){this.p=t,this.b=i,this.nc.onaddtrack=this.Bi.bind(this),this.nc.onremovetrack=this.Ci.bind(this),this.nc.onchange=this.Di.bind(this),h(this.b.audioTracks,"change",this.Ei.bind(this))}get nc(){return this.p.media.audioTracks}Bi(t){const i=t.track;if(i.label==="")return;const e=i.id.toString()||`native-audio-${this.b.audioTracks.length}`,a={id:e,label:i.label,language:i.language,kind:i.kind,selected:!1};this.b.audioTracks[l.da](a,t),i.enabled&&(a.selected=!0)}Ci(t){const i=this.b.audioTracks.getById(t.track.id);i&&this.b.audioTracks[l.cc](i,t)}Di(t){let i=this.ig();if(!i)return;const e=this.b.audioTracks.getById(i.id);e&&this.b.audioTracks[l.ea](e,!0,t)}ig(){return Array.from(this.nc).find(t=>t.enabled)}Ei(t){const{current:i}=t.detail;if(!i)return;const e=this.nc.getTrackById(i.id);if(e){const a=this.ig();a&&(a.enabled=!1),e.enabled=!0}}}class J{constructor(t,i){this.a=t,this.b=i,this.scope=v(),this.K=null,this.audioGain=new K(this.a,e=>{this.b.delegate.c("audio-gain-change",e)})}setup(){new z(this,this.b),"audioTracks"in this.media&&new O(this,this.b),m(()=>{this.audioGain.destroy(),this.a.srcObject=null,this.a.removeAttribute("src");for(const t of this.a.querySelectorAll("source"))t.remove();this.a.load()})}get type(){return""}get media(){return this.a}get currentSrc(){return this.K}setPlaybackRate(t){this.a.playbackRate=t}async play(){return this.a.play()}async pause(){return this.a.pause()}setMuted(t){this.a.muted=t}setVolume(t){this.a.volume=t}setCurrentTime(t){this.a.currentTime=t}setPlaysInline(t){n(this.a,"playsinline",t)}async loadSource({src:t,type:i},e){this.a.preload=e||"",T(t)?(this.oc(),this.a.srcObject=t):(this.a.srcObject=null,S(t)?i!=="?"?this.ge({src:t,type:i}):(this.oc(),this.a.src=this.jg(t)):(this.oc(),this.a.src=window.URL.createObjectURL(t))),this.a.load(),this.K={src:t,type:i}}ge(t,i){const e=this.a.querySelector("source[data-vds]"),a=e??document.createElement("source");n(a,"src",this.jg(t.src)),n(a,"type",t.type!=="?"?t.type:i),n(a,"data-vds",""),e||this.a.append(a)}oc(){var t;(t=this.a.querySelector("source[data-vds]"))==null||t.remove()}jg(t){const{clipStartTime:i,clipEndTime:e}=this.b.$state,a=i(),r=e();return a>0&&r>0?`${t}#t=${a},${r}`:a>0?`${t}#t=${a}`:r>0?`${t}#t=0,${r}`:t}}class R{constructor(t,i){this.a=t,this.b=i,this.pb=b(!1),this.he()}get supported(){return this.pb()}he(){var t;!((t=this.a)!=null&&t.remote)||!this.kg||(this.a.remote.watchAvailability(i=>{this.pb.set(i)}).catch(()=>{this.pb.set(!1)}),y(this.Fi.bind(this)))}Fi(){if(!this.pb())return;const t=["connecting","connect","disconnect"],i=this.ie.bind(this);i(),h(this.a,"playing",i);for(const e of t)h(this.a.remote,e,i)}async prompt(){if(!this.supported)throw Error("Not supported on this platform.");return this.la==="airplay"&&this.a.webkitShowPlaybackTargetPicker?this.a.webkitShowPlaybackTargetPicker():this.a.remote.prompt()}ie(t){const i=this.a.remote.state;if(i===this.za)return;const e={type:this.la,state:i};this.b.delegate.c("remote-playback-change",e,t),this.za=i}}class q extends R{constructor(){super(...arguments),this.la="airplay"}get kg(){return"WebKitPlaybackTargetAvailabilityEvent"in window}}export{J as H,q as a};
