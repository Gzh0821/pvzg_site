import{b2 as b,a1 as m,bf as y,W as v,Y as g,bB as k,bm as f,aY as w,aV as d,bA as u,a3 as S}from"./app-_dfQPi0m.js";import{E as R}from"./vidstack-DBsjVADd-C9ab37bj.js";import{resolveYouTubeVideoId as T}from"./vidstack-Zc3I7oOd-CA6XwpqT.js";const r={Om:-1,pg:0,qg:1,gj:2,hj:3,ij:5};class z extends R{constructor(t,e){super(t),this.b=e,this.$$PROVIDER_TYPE="YOUTUBE",this.scope=b(),this.ha=m(""),this.za=-1,this.K=null,this.md=-1,this.vc=!1,this.Rn=new Map,this.language="en",this.color="red",this.cookies=!1}get c(){return this.b.delegate.c}get currentSrc(){return this.K}get type(){return"youtube"}get videoId(){return this.ha()}preconnect(){y(this.Nb())}setup(){super.setup(),v(this.we.bind(this)),this.c("provider-setup",this)}destroy(){this.z();const t="provider destroyed";for(const e of this.Rn.values())for(const{reject:s}of e)s(t);this.Rn.clear()}async play(){return this.t("playVideo")}Hn(t){var e;(e=this.Sn("playVideo"))==null||e.reject(t)}async pause(){return this.t("pauseVideo")}In(t){var e;(e=this.Sn("pauseVideo"))==null||e.reject(t)}setMuted(t){t?this.t("mute"):this.t("unMute")}setCurrentTime(t){this.vc=this.b.$state.paused(),this.t("seekTo",t),this.c("seeking",t)}setVolume(t){this.t("setVolume",t*100)}setPlaybackRate(t){this.t("setPlaybackRate",t)}async loadSource(t){if(!g(t.src)){this.K=null,this.ha.set("");return}const e=T(t.src);this.ha.set(e??""),this.K=t}Nb(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}we(){this.z();const t=this.ha();if(!t){this.sc.set("");return}this.sc.set(`${this.Nb()}/embed/${t}`),this.c("load-start")}mg(){const{keyDisabled:t}=this.b.$props,{muted:e,playsInline:s,nativeControls:i}=this.b.$state,a=i();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:a?1:void 0,color:this.color,controls:a?1:0,disablekb:!a||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:a?1:3,mute:e()?1:0,playsinline:s()?1:0}}t(t,e){let s=k(),i=this.Rn.get(t);return i||this.Rn.set(t,i=[]),i.push(s),this.se({event:"command",func:t,args:e?[e]:void 0}),s.promise}gd(){window.setTimeout(()=>this.se({event:"listening"}),100)}kd(t){this.c("loaded-metadata"),this.c("loaded-data"),this.b.delegate.Ga(void 0,t)}ib(t){var e;(e=this.Sn("pauseVideo"))==null||e.resolve(),this.c("pause",void 0,t)}mc(t,e){const{duration:s,realCurrentTime:i}=this.b.$state,a=this.za===r.pg,o=a?s():t;this.c("time-change",o,e),!a&&Math.abs(o-i())>1&&this.c("seeking",o,e)}nb(t,e,s){const i={buffered:new u(0,t),seekable:e};this.c("progress",i,s);const{seeking:a,realCurrentTime:o}=this.b.$state;a()&&t>o()&&this.ob(s)}ob(t){const{paused:e,realCurrentTime:s}=this.b.$state;window.clearTimeout(this.md),this.md=window.setTimeout(()=>{this.c("seeked",s(),t),this.md=-1},e()?100:0),this.vc=!1}lc(t){const{seeking:e}=this.b.$state;e()&&this.ob(t),this.c("pause",void 0,t),this.c("end",void 0,t)}ie(t,e){var l;const{started:s,paused:i,seeking:a}=this.b.$state,o=t===r.qg,h=t===r.hj,c=!f(this.Sn("playVideo")),n=(i()||c)&&(h||o);if(h&&this.c("waiting",void 0,e),a()&&o&&this.ob(e),!s()&&n&&this.vc){this.Hn("invalid internal play operation"),o&&(this.pause(),this.vc=!1);return}switch(n&&((l=this.Sn("playVideo"))==null||l.resolve(),this.c("play",void 0,e)),t){case r.Om:this.Hn("provider rejected"),this.In("provider rejected"),this.c("pause",void 0,e);break;case r.ij:this.kd(e);break;case r.qg:this.c("playing",void 0,e);break;case r.gj:this.ib(e);break;case r.pg:this.lc(e);break}this.za=t}te({info:t},e){var o;if(!t)return;const{title:s,intrinsicDuration:i,playbackRate:a}=this.b.$state;if(w(t.videoData)&&t.videoData.title!==s()&&this.c("title-change",t.videoData.title,e),d(t.duration)&&t.duration!==i()){if(d(t.videoLoadedFraction)){const h=((o=t.progressState)==null?void 0:o.loaded)??t.videoLoadedFraction*t.duration,c=new u(0,t.duration);this.nb(h,c,e)}this.c("duration-change",t.duration,e)}if(d(t.playbackRate)&&t.playbackRate!==a()&&this.c("rate-change",t.playbackRate,e),t.progressState){const{current:h,seekableStart:c,seekableEnd:n,loaded:l,duration:p}=t.progressState;this.mc(h,e),this.nb(l,new u(c,n),e),p!==i()&&this.c("duration-change",p,e)}if(d(t.volume)&&S(t.muted)){const h={muted:t.muted,volume:t.volume/100};this.c("volume-change",h,e)}d(t.playerState)&&t.playerState!==this.za&&this.ie(t.playerState,e)}z(){this.za=-1,this.md=-1,this.vc=!1}Sn(t){var e;return(e=this.Rn.get(t))==null?void 0:e.shift()}}export{z as YouTubeProvider};
